<UserControl x:Class="ConsistencyCalculator.Desktop.Views.DeckEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0 0 0 10">
            
            <TextBox Width="150" Margin="0 0 5 0"    
                     Tag="Card Name"
                     Text="{Binding CardName, UpdateSourceTrigger=PropertyChanged}"/>
            
            <TextBox Width="150"
                     Tag="Tags (ex: starter, brick, ht)"
                     Text="{Binding CardTags, UpdateSourceTrigger=PropertyChanged}"
                     PreviewTextInput="TextBox_PreviewTextInput" 
                     DataObject.Pasting="TextBox_Pasting"/>

            <TextBox Width="60" Margin="0 0 5 0"
                     Tag="Quantity"
                     Text="{Binding Quantity}"/>

            <Button Content="Add" Margin="0 0 10 0"
                    Command="{Binding AddCardCommand}"/>


            <Button Content="Import .ydk" Margin="0 0 10 0"
                    Command="{Binding ImportYdkCommand}"/>

        </StackPanel>

        <DataGrid Grid.Row="1" 
                  ItemsSource="{Binding Cards}"
                  AutoGenerateColumns="False"
                  CellEditEnding="DataGrid_CellEditEnding"
                  CanUserAddRows="False" Margin="0 0 0 0" >

            <DataGrid.Columns>

                <DataGridTextColumn Header="Name"
                                    Binding="{Binding Name}"
                                    IsReadOnly="True"
                                    Width="3*" />

                <DataGridTextColumn Header="Quantity"
                                    Binding="{Binding Quantity,
                                                      Mode=TwoWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Width="60" />

                <DataGridTextColumn Header="Tags" Width="*"
                    Binding="{Binding TagsText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <DataGridTextColumn.EditingElementStyle>
                        <Style TargetType="TextBox">
                            <EventSetter Event="PreviewTextInput"
                         Handler="TextBox_PreviewTextInput"/>
                            <EventSetter Event="DataObject.Pasting"
                         Handler="TextBox_Pasting"/>
                        </Style>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>

                <DataGridTemplateColumn Header="✕"
                                Width="40">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="✕"
                            Width="22"
                            Height="22"
                            FontWeight="Bold"
                            Padding="0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Command="{Binding DataContext.RemoveCommand,
                                              RelativeSource={RelativeSource AncestorType=DataGrid}}"
                            CommandParameter="{Binding}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="2"
            Padding="8"
            Background="#EEE"
            BorderThickness="1"
            BorderBrush="#CCC">
            <TextBlock FontWeight="Bold"
                       Foreground="{Binding TotalCards,
                     Converter={StaticResource IntToBrushConverter}}"
                       Text="{Binding TotalCards,
                                      StringFormat=Total: {0}}"/>
            
        </Border>

    </Grid>
</UserControl>
